{% extends 'core/base.html' %}
{% block title %}Buy Bundle | RichDataBundles{% endblock %}
{% block content %}
<h2>Buy a Data Bundle</h2>

{% if bundles %}
  <form method="post" class="form" id="buyForm">{% csrf_token %}
    <div class="grid" style="margin-bottom:18px;">
      {% for b in bundles %}
        <label class="bundle-card" style="cursor:pointer; border: 2px solid transparent;">
          <input type="radio" name="bundle_code" value="{{ b.bundle_code }}" style="display:none;"
                 {% if selected_code and selected_code == b.bundle_code %}checked{% endif %}>
          <div style="padding:12px;">
            <div class="bundle-head">{{ b.network }} â€¢ {{ b.size_label }}</div>
            <div class="bundle-price">{{ b.price }} GHS</div>
          </div>
        </label>
      {% endfor %}
    </div>

    <label>Recipient number</label>
    {{ form.recipient }}

    <!-- amount will be computed server-side from selected bundle -->
    <button class="btn" type="submit" style="margin-top:12px">Pay & Buy</button>
  </form>

  <script>
    // Simple visual highlight for chosen bundle (no extra libs)
    document.addEventListener('click', function(e){
      const card = e.target.closest('.bundle-card');
      if(!card) return;
      // unselect all
      document.querySelectorAll('.bundle-card').forEach(c => c.style.border = '2px solid transparent');
      // mark chosen
      card.style.border = '2px solid #4b0db5';
      // ensure radio is checked
      const radio = card.querySelector('input[type="radio"]');
      if(radio) radio.checked = true;
    });

    // Auto-select the preselected code (if page loaded with selected_code)
    (function(){
      const selected = "{{ selected_code|default:'' }}";
      if(selected){
        const r = document.querySelector('input[type="radio"][value="'+selected+'"]');
        if(r){ r.checked = true; r.closest('.bundle-card').style.border = '2px solid #4b0db5'; }
      }
    })();
  </script>

{% else %}
  <p>No bundles available right now. Please check back later or contact support.</p>
{% endif %}

<p style="margin-top:12px;color:#374151;">Note: Payment is verified with Paystack before a DataDash top-up is requested.</p>
{% endblock %}
