{% extends 'core/base.html' %}
{% load static %}
{% block title %}Buy a Data Bundle | RichDataBundles{% endblock %}
{% block content %}

<div class="container py-4">
  <h2 class="text-center mb-4 fw-bold text-primary">Buy a Data Bundle</h2>

  <!-- Network selector -->
  <form method="get" action="" class="mb-4 text-center">
    <label for="network" class="form-label me-2 fw-semibold">Select Network:</label>
    <select name="network" id="network" class="form-select d-inline-block w-auto" onchange="this.form.submit()">
      <option value="MTN" {% if network == 'MTN' %}selected{% endif %}>MTN</option>
      <option value="AIRTELTIGO" {% if network == 'AIRTELTIGO' %}selected{% endif %}>AirtelTigo</option>
      <option value="VODAFONE" {% if network == 'VODAFONE' %}selected{% endif %}>Vodafone</option>
    </select>
  </form>

  {% if bundles %}
  <form method="POST" id="buyForm" class="card p-4 shadow-sm border-0 mx-auto" style="max-width: 500px;">
    {% csrf_token %}

    <div class="mb-3">
      <label for="bundle_name" class="form-label fw-semibold">Select Data Plan</label>
      <select name="bundle_name" id="bundle_name" class="form-select" required>
        <option value="">-- Choose Bundle --</option>
        {% for b in bundles %}
          <option value="{{ b.name }}" data-price="{{ b.price }}">
            {{ b.name }} â€” {{ b.price }} GHS
          </option>
        {% endfor %}
      </select>
    </div>

    <div class="mb-3">
      <label for="phone_number" class="form-label fw-semibold">Recipient Phone Number</label>
      <input type="text" name="phone_number" id="phone_number" class="form-control"
             placeholder="Enter receiver's number (e.g. 024XXXXXXX)" required>
    </div>

    <div class="mb-3">
      <label for="amount" class="form-label fw-semibold">Amount (â‚µ)</label>
      <input type="text" name="amount" id="amount" class="form-control" readonly required>
    </div>

    <button type="submit" class="btn btn-success w-100 fw-bold">
      <i class="fa fa-lock me-1"></i> Pay & Buy
    </button>
  </form>
  {% else %}
    <div class="alert alert-warning text-center mt-4">
      <i class="fa fa-info-circle"></i> No bundles available right now. Please check back later or contact support.
    </div>
  {% endif %}

  <p class="text-center mt-4 text-muted small">
    ðŸ’¡ Payment is verified with Paystack before your DataDash top-up is sent.
  </p>

  <footer class="text-center text-muted small mt-5">
    Â© 2025 <strong>RichDataBundles</strong>. All Rights Reserved.
  </footer>
</div>

<script>
  // Auto-fill amount when user selects a bundle
  const bundleSelect = document.getElementById("bundle_name");
  const amountInput = document.getElementById("amount");
  if (bundleSelect) {
    bundleSelect.addEventListener("change", () => {
      const selected = bundleSelect.options[bundleSelect.selectedIndex];
      amountInput.value = selected.getAttribute("data-price") || "";
    });
  }
</script>

{% endblock %}
