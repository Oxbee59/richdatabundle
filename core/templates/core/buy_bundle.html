{% extends "core/base.html" %}
{% load static %}

{% block content %}
<div class="container my-4">
  <h2 class="text-center mb-4">Buy Data Bundle</h2>

  <form method="POST" id="buyForm" novalidate>
    {% csrf_token %}
    <div class="mb-3">
      <label for="recipient" class="form-label fw-semibold">Recipient Number</label>
      <input id="recipient" name="recipient" type="text" class="form-control" placeholder="054XXXXXXXX" required>
    </div>

    <!-- Hidden field to hold selected bundle ID -->
    <input type="hidden" name="bundle_id" id="bundle_id" value="">

    <div class="row g-3">
      {% for bundle in bundles %}
      <div class="col-12 col-sm-6 col-md-4">
        <div class="card h-100 shadow-sm border-0"
             style="border-top: 6px solid {{ bundle.color|default:'#6c757d' }};">
          <div class="card-body d-flex flex-column justify-content-between">
            <div>
              <div class="fw-bold">{{ bundle.name }}</div>
              {% if bundle.description %}
              <div class="small text-muted mb-2">{{ bundle.description }}</div>
              {% endif %}
            </div>

            <div class="d-flex align-items-center justify-content-between mt-3">
              <div>
                <div class="h5 mb-0 fw-bold">â‚µ{{ bundle.price }}</div>
                <div class="small text-muted">Inclusive</div>
              </div>

              <button type="button"
                      class="btn btn-primary btn-sm btn-buy"
                      data-bundle-id="{{ bundle.id }}">
                Buy
              </button>
            </div>
          </div>
        </div>
      </div>
      {% empty %}
      <div class="col-12">
        <div class="alert alert-info text-center">
          No bundles available yet. Please check back soon.
        </div>
      </div>
      {% endfor %}
    </div>
  </form>
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {
  const buyButtons = document.querySelectorAll(".btn-buy");
  const form = document.getElementById("buyForm");
  const bundleInput = document.getElementById("bundle_id");
  const recipientInput = document.getElementById("recipient");

  buyButtons.forEach(btn => {
    btn.addEventListener("click", function() {
      const bundleId = this.dataset.bundleId;
      if (!recipientInput.value || recipientInput.value.trim().length < 6) {
        alert("Please enter a valid recipient number before buying.");
        recipientInput.focus();
        return;
      }
      bundleInput.value = bundleId;
      form.submit();
    });
  });
});
</script>
{% endblock %}
